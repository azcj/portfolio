<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Seasonality detection with the discrete Fourier transform | Aryana Collins Jackson</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="My masters thesis, part 1">
    <meta name="generator" content="Hugo 0.71.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
<link rel="stylesheet" href="https://azcj.github.io/portfolio/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="Seasonality detection with the discrete Fourier transform" />
<meta property="og:description" content="My masters thesis, part 1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://azcj.github.io/portfolio/projects/seasonality_dft/" />
<meta property="article:published_time" content="2022-01-30T11:14:48-04:00" />
<meta property="article:modified_time" content="2022-01-30T11:14:48-04:00" /><meta property="og:site_name" content="Aryana Collins Jackson" />
<meta itemprop="name" content="Seasonality detection with the discrete Fourier transform">
<meta itemprop="description" content="My masters thesis, part 1">
<meta itemprop="datePublished" content="2022-01-30T11:14:48-04:00" />
<meta itemprop="dateModified" content="2022-01-30T11:14:48-04:00" />
<meta itemprop="wordCount" content="1413">



<meta itemprop="keywords" content="mathematics,seasonality detection,time series analysis," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Seasonality detection with the discrete Fourier transform"/>
<meta name="twitter:description" content="My masters thesis, part 1"/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://azcj.github.io/portfolio/images/DFT_equation1.png');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://azcj.github.io/portfolio/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Aryana Collins Jackson
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://azcj.github.io/portfolio/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://azcj.github.io/portfolio/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://azcj.github.io/portfolio/projects/" title="Projects page">
              Projects
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
    <a href="https://www.linkedin.com/in/aryana-collins-jackson-6100ba139/" target="_blank" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:{{ .fill }};"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>
  
</div>
    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Seasonality detection with the discrete Fourier transform</h1>
          
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              My masters thesis, part 1
            </h2>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        PROJECTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
      
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://azcj.github.io/portfolio/projects/seasonality_dft/&amp;title=Seasonality%20detection%20with%20the%20discrete%20Fourier%20transform" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn">
        
        <span class="icon"> <svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:{{ .fill }};"/>
</svg>
</span>
        
      </a>
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Seasonality detection with the discrete Fourier transform</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-01-30T11:14:48-04:00">January 30, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Overview:</p>
<ul>
<li>Used Python to apply the discrete Fourier transform (DFT) to sample sparse seasonal data</li>
<li>Returned number of cycles, period length, number of cycles, and signal shift</li>
</ul>
<hr>
<p><em>If this page has been helpful to you in your own research, please consider citing</em> <em><a href="https://www.researchgate.net/publication/341623703_The_discrete_Fourier_transformation_for_seasonality_and_anomaly_detection_on_an_application_to_rare_data">the paper where this work is published.</a></em></p>
<p>During my masters in data science and analytics, I found myself gravitating towards the math side of things. I hadn&rsquo;t done anything mathsy in years, but I quickly found that regardless of what I worked on, I enjoyed working with the equations that were at the heart of it. Luckily, my thesis involved time series analysis. The manner in which I chose to work on the problem involved working with equations, which I loved. On this page, I outline the problem and my solution, but do note that the DFT was not the first method I tried, and there were, in fact, many hours of work that went into other methods.</p>
<p><strong>1. THE PROBLEM</strong></p>
<p>Most time series data involves non-sparse data - that is to say that most time points contain non-zeroes. For example, think about traffic data that monitors the number of visitors to a website: unless the site is very unpopular or the time scale of the data is too small, most of the time points in the data will contain non-zero figures.</p>
<p><img src="https://azcj.github.io/portfolio/images/q2-insights-1.png" alt="Site traffic data">
<em>Site traffic data courtesy of <a href="https://www.similarweb.com/corp/blog/research/digital-analysis/top-web-trends-2021/" title="similarweb">similarweb</a></em></p>
<p>As shown by the graph above, most time series data is not sparse. However, there are cases in which data <em>is</em> sparse - for example, imagine an internal server that is accessed by an individual once in a while in order to perform a health check on some kind of process. Perhaps it&rsquo;s important that this happens every Monday between 9:00am and 9:05am. In order to monitor this event, the data should be sampled every five minutes. A week of data would therefore contain 2,016 data points, 2,015 of which should be 0s and one of which should be a 1 to indicate the event.</p>
<p><strong>2. WHY DFT</strong></p>
<p>Identifying whether seasonality is present in this kind of data is nearly impossible with traditional methods. Therefore, I chose an algorithm called the discrete Fourier transform  (DFT to keep things short). I won&rsquo;t go into a ton of detail here about all the different applications for it, but essentially, it takes a signal and identifies the components of that signal to a very precise degree.</p>
<p><strong>3. THE DFT EQUATION</strong></p>
<p>There are two different representations of the DFT equation, and here is one of those:</p>
<p><img src="https://azcj.github.io/portfolio/images/DFT_equation1.png" alt="DFT equation"></p>
<p>This equation converts a sequence of <em>N</em> complex numbers to a new sequence of <em>N</em> complex numbers for 0 ≤ <em>k</em> ≤ <em>N</em> - 1. Essentially, this function takes data existing on the time domain and translates it onto the frequency domain.</p>
<p>While it&rsquo;s possible to calculate this by hand or in code with a manual approach, we luckily have a few different Python libraries that we can use instead. I chose to use NumPy here, but SciPy also has a very good package for dealing with the DFT as well. I used the following code to calculate this equation. Here, <em>y</em> is a one-dimensional array of time series data.</p>
<pre><code>import numpy as np
sp = np.fft.fft(y) 
</code></pre>
<p><strong>4. CYCLE COUNT DETECTION</strong></p>
<p>Okay, so the first step here is determining the number of cycles present in a signal. To demonstrate how this works, I used the following array that represents an event occurring twice weekly, on the first and fourth days of the week, for 56 days (8 weeks):</p>
<pre><code>y = np.array(1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0).
</code></pre>
<p>In order to extract the number of cycles, I calculate the DFT and simply plot the resulting <em>N</em> sequence, or DFT coefficients:</p>
<pre><code>dft = np.fft.fft(y) 
plt.stem(dft)
</code></pre>
<p>The first ten DFT coefficients are in the table below:</p>
<p><img src="https://azcj.github.io/portfolio/images/DFT-coefficients.png" alt="DFT coefficients"></p>
<p>And the stem plot of the entire array looks like this:</p>
<p><img src="https://azcj.github.io/portfolio/images/DFT-stem.png" alt="DFT stem plot"></p>
<p>The coefficient at index zero is referred to as the DC component which is the mean amplitude of the signal. It describes how often on average a cycle is completed. Here, the DC component here 16. The number of sampled points <em>N</em>, divided by the DC component yields 3.5, which means a signal completes on average every 3.5 days - or that on average, two cycles complete every seven days.</p>
<p><strong>5. PERIOD LENGTH DETECTION</strong></p>
<p>While examining the DC component was useful in terms of detecting period length of each cycle, it doesn&rsquo;t provide an exact figure. First, I separated the two cycles and extracted just a single one, represented by the following array:</p>
<pre><code>y = np.array(1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0)
</code></pre>
<p>In order to get that exact figure to determine period length, I used spectral analysis, which finds frequency bins (relating to the period in the time domain) and their associated power using power spectrum density (PSD). The Nyquist Sampling Theorem states that the largest frequency that can be returned
is N/2 + 1. PSD is calculated using the following equation:</p>
<p><img src="https://azcj.github.io/portfolio/images/PSD-equation.png" alt="Power spectral density equation"></p>
<p>Where <em>Fs</em> is the sampling frequency, <em>N</em> is the number of total samples, <em>Pxx</em> is the PSD, and <em>f</em> is each frequency. This can be calculated in Python with:</p>
<pre><code>freq = np.fft.fftfreq(len(y))
ind = np.arange(1,int(len(y)/2 + 1))
psd = abs(dft[ind])**2 + abs(dft[-ind])**2
</code></pre>
<p>And plotted with:</p>
<pre><code>plt.plot(freq[ind], psd, &quot;k-&quot;)
</code></pre>
<p><img src="https://azcj.github.io/portfolio/images/PSD-graph.png" alt="Power spectral density graph"></p>
<p>Any index above a 0.4 threshold is considered a frequency to note. The data is refined
to include just those points with a frequency above 0.4. The graph above shows the frequencies plotted against PSD, in wattz/Hz. The PSD figures are (rounded): 0.1429, 0.2857, and 0.4286. The reasoning for multiple frequencies beyond the first here may be the result of aliasing, which I may explain in a further post.</p>
<p>However, the first one is the only one I care about. The period is found by dividing 1 by the frequency. In this case, 1/0.1429 = 7. Thus the signal is determined to be
seasonal, and its period is 7 days.</p>
<p><strong>6. SIGNAL SHIFT DETECTION</strong></p>
<p>Now that I&rsquo;ve identified the number of cycles and the periods of each cycle, I want to see if the signals are shifted along the time domain. For example, a dataset may begin
with a non-event instance (i.e., 0) and the second instance may contain an event (i.e., 1). For this part, I use the following array:</p>
<pre><code>y2 = np.array(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0)
</code></pre>
<p>The Convolution theorem states that a convolution in the time domain is equal to a pointwise multiplication in the frequency domain [6]. In practice, the inverse tangent (also known as the negative arctangent) function, which calculates the angle between the real and imaginary parts, is used. That equation looks like this:</p>
<p><img src="https://azcj.github.io/portfolio/images/convolution-eq.png" alt="Convolution theorem"></p>
<p>In Python, this can be calculated with:</p>
<pre><code>R_xy = np.fft.ifft(np.fft.fft(y2) * np.conj(np.fft.fft(y))) / (np.linalg.norm(y2) * np.linalg.norm(y))
</code></pre>
<p>Essentially, I have an array (y2) whose period I know. I do not know if this signal is shifted though. So I compare it to another array with the same period and signal length that I know <em>isn&rsquo;t</em> shifted along the time domain. This produces what&rsquo;s called the complex conjugate, which can be plotted as well with:</p>
<pre><code>plt.plot(R_xy)
</code></pre>
<p><img src="https://azcj.github.io/portfolio/images/complex-conjugate.png" alt="Complex conjugate graph"></p>
<p>As shown, the first peak in the graph occurs at index 3, indicating a signal shift of 4 days. Thus the events in this signal occur on the fourth day of the signal.</p>
<hr>
<p><strong>Final thoughts:</strong></p>
<ul>
<li>The methods outlined here can be completed on any number of signals and have been proven to be robust</li>
<li>Making the signals binary was a choice that made working with the DFT much easier. However, it does present some challenges (what happens if two events occur during the same sampled time point?)</li>
</ul>
<ul class="pa0">
  
   <li class="list">
     <a href="https://azcj.github.io/portfolio/tags/mathematics" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">mathematics</a>
   </li>
  
   <li class="list">
     <a href="https://azcj.github.io/portfolio/tags/seasonality-detection" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">seasonality detection</a>
   </li>
  
   <li class="list">
     <a href="https://azcj.github.io/portfolio/tags/time-series-analysis" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">time series analysis</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="https://azcj.github.io/portfolio/projects/computational_sl/">Computational situational leadership</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://azcj.github.io/portfolio/" >
    &copy;  Aryana Collins Jackson 2022 
  </a>
    <div>
<div class="ananke-socials">
  
    <a href="https://www.linkedin.com/in/aryana-collins-jackson-6100ba139/" target="_blank" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:{{ .fill }};"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>
  
</div></div>
  </div>
</footer>

  </body>
</html>
